import asyncio

from mistralai.async_client import MistralAsyncClient
from mistralai.models.chat_completion import ChatMessage

spam_texts = ";\n".join(
    [
        """–ï—Å—Ç—å –Ω–æ–≤–∞—è –¢–µ–º–∞
–í–æ–∑—å–º–µ–º 1 —á–µ–ª–æ–≤–µ—á–∫–∞ 
–û—Ç 200-300+ –¥–æ–ª–ª–∞—Ä–æ–≤  –≤  –¥–µ–Ω—å
–†–∞–±–æ—Ç–∞ —Å–æ —Å–≤–æ–∏–º –∫–∞–ø–∏—Ç–∞–ª–æ–º 
1-2 —á–∞—Å–∞ –∑–∞–Ω—è—Ç–æ—Å—Ç—å 
–ò–Ω—Ç–µ—Ä–µ—Å–Ω–æ?: –ü–∏—à–∏—Ç–µ + –≤ –õ–°""",
        """–ò–©–£ –õ–Æ–îE–ô –í –öO–úA–ù–î–£ –ùA –ùO–í–´–ô –üPOEKT 21+
–¢–ï–°–¢U–†–û–í–©U–ö CETU –úO–ùET üí•

üü¢–ë–µ—Å–ø–ª–∞—Ç–Ω–æ–µ –æ–±—É—á–µ–Ωu–µ no–ª–Ωo—Å—Ç—å—é —Å –Ωy–ª—è;
üìån–æ—Ç–µ–Ω—Üu–∞–ª –¥oxo–¥a: 2000 $ –≤ –Ω–µ–¥–µ–ª—é

–Ω–∞–øu—àu –º–Ω–µ""",
        """Ec—Ç—å y–¥a–ªe–Ω–∫–∞ –Ω–∞ –øoc—Ç–æ—è–Ω–Ωo–π o—Å–Ωo–≤e! –îoxo–¥ o—Ç 85$ –≤ –¥e–Ω—å –∏ –≤—ã—àe. –ü–∏—à–∏ + –≤ –ª—Å –∏ y–∑–Ωa–≤a–π –øo–¥po–±–Ωoc—Ç–∏.
18+""",
        """–ï—Å—Ç—å —É–¥–∞–ª—ë–Ω–Ω–∞—è —Ä–∞–±–æ—Ç–∞ –¥–ª—è –≤–∞—Å
–†–∞–±–æ—Ç–∞ –≤ —Å—Ñ–µ—Ä–µ –æ–±—â–µ–Ω–∏—è 
–ó–∞—Ä–ø–ª–∞—Ç–∞ –æ—Ç 200$ –∑–∞ –Ω–µ–¥–µ–ª—é
–ü–∏—à–∏—Ç–µ –≤—Å—ë –æ–±—Å—É–¥–∏–º""",
        """"–†–µ–∞–ª—å–Ω–∞—è –¢–µ–º–∞
270+ –ë–∞–∫—Å–æ–≤ –≤ –¥–µ–Ω—å 
(  –° —Ç–µ–ª–µ—Ñ–æ–Ω–∞ –∏–ª–∏ –ü–ö )
2 —á–∞—Å–∞ –≤ –¥–µ–Ω—å –∑–∞–Ω—è—Ç–æ—Å—Ç—å 
–ü–∏—à–∏ + –≤ –õ–° –∑–∞ –ø–æ–¥—Ä–æ–±–Ω–æ—Å—Ç—è–º–∏""",
        """Pocce–ª—åxo–∑–±a–Ω–∫ –¥–∞—Ä–∏—Ç 6000 —Ä—É–±–ª–µ–π –∫–∞–∂–¥–æ–º—É –∫–ª–∏–µ–Ω—Ç—É.
 
–ü–æ–ª—É—á–∏—Ç—å - https://link...""",
        """–ü—Ä–∏–≤–µ—Ç! –ù–æ–≤–∞—è —Å—Ñ–µ—Ä–∞, —É–¥–∞–ª–µ–Ω–Ω—ã–π –∑–∞—Ä–∞–±–æ—Ç–æ–∫ –ø—Ä—è–º–æ —Å –¥–æ–º–∞! 
–î–ª—è —Ä–∞–±–æ—Ç—ã –Ω—É–∂–µ–Ω —Ç–æ–ª—å–∫–æ —Ç–µ–ª–µ—Ñ–æ–Ω –∏–ª–∏ –ø–∫! 
–ó–∞–Ω—è—Ç–æ—Å—Ç—å 1-2 —á–∞—Å–∞ –≤ –¥–µ–Ω—å! 
–ó–∞—Ä–∞–±–æ—Ç–æ–∫ –æ—Ç 9000 —Ä—É–±. –≤ –¥–µ–Ω—å! 
–ü–∏—à–∏—Ç–µ –≤ –ª—Å üî•""",
        """—Ä–∞–±–æ—Ç–∞—è –∏–∑ –¥–æ–º–∞! –ù—É–∂–µ–Ω —Ç–æ–ª—å–∫–æ –∫–æ–º–ø—å—é—Ç–µ—Ä. –ù–∏–∫–∞–∫–∏—Ö –≤–ª–æ–∂–µ–Ω–∏–π! –ü–∏—à–∏—Ç–µ –º–Ω–µ –≤ –õ–° –¥–ª—è –ø–æ–¥—Ä–æ–±–Ω–æ—Å—Ç–µ–π""",
        """–ü–æ–ª—É—á–∏ –±–æ–Ω—É—Å 7000 —Ä—É–±–ª–µ–π –ø—Ä–æ—Å—Ç–æ –∑–∞ —Ä–µ–≥–∏—Å—Ç—Ä–∞—Ü–∏—é –≤ –Ω–∞—à–µ–π —Å–∏—Å—Ç–µ–º–µ! –ë—ã—Å—Ç—Ä–æ –∏ –ª–µ–≥–∫–æ! –ü–µ—Ä–µ–π–¥–∏ –ø–æ —Å—Å—ã–ª–∫–µ""",
        """–ë–µ—Å–ø–ª–∞—Ç–Ω—ã–π –≤–µ–±–∏–Ω–∞—Ä –ø–æ –∑–∞—Ä–∞–±–æ—Ç–∫—É –≤ –∏–Ω—Ç–µ—Ä–Ω–µ—Ç–µ! –ì–∞—Ä–∞–Ω—Ç–∏—Ä–æ–≤–∞–Ω–Ω—ã–π –¥–æ—Ö–æ–¥ –ø–æ—Å–ª–µ""",
        """–ü—Ä–∏–≤–µ—Ç! –ù–æ–≤–∞—è —Å—Ñ–µ—Ä–∞, —É–¥–∞–ª–µ–Ω–Ω—ã–π –∑–∞—Ä–∞–±–æ—Ç–æ–∫ –ø—Ä—è–º–æ —Å –¥–æ–º–∞! –ü–∏—à–∏""",
    ]
)


async def check_spam(mistral_client: MistralAsyncClient, text: str) -> bool:
    chat_response = await mistral_client.chat(
        model="mistral-tiny",
        messages=[
            ChatMessage(
                role="user",
                content=f"""You're a professional spam detector, you have to detect if the following text is spam or not. Answer ONLY with Y/N, NOTHING ELSE. 
You have to detect only similar spam texts like these ones:
{spam_texts}
Users are generally allowed to send links, but not with spammy texts.
Spam text is not allowed, like the ones above, but not exactly the same.
Here's the text to analyze: {text}""",
            )
        ],
        max_tokens=1,
    )
    # Assuming the response is just 'Y' or 'N'
    content = chat_response.choices[0].message.content
    print(f"Content: {content}")
    return content == "Y"


async def test_checker():
    mistral_client = MistralAsyncClient("")
    for text in [
        """–ü—Ä–∏–≤–µ—Ç! –ù–æ–≤–∞—è —Å—Ñ–µ—Ä–∞, —É–¥–∞–ª–µ–Ω–Ω—ã–π –∑–∞—Ä–∞–±–æ—Ç–æ–∫ –ø—Ä—è–º–æ —Å –¥–æ–º–∞! –ü–∏—à–∏""",
        "https://console.mistral.ai/",
        """–†–æ—Å–±–∞–Ω–∫ –ø–ª–∞—Ç–∏—Ç 6000 —Ä—É–±–ª–µ–π –∫–∞–∂–¥–æ–º—É –∫–ª–∏–µ–Ω—Ç—É!
 
–ü–æ–ª—É—á–∏—Ç—å - https://rosbank.ru/bonus""",
    ]:
        print(await check_spam(mistral_client, text))


if __name__ == "__main__":
    asyncio.run(test_checker())
